From 45a7db21694638623686f112eda1789566113a2a Mon Sep 17 00:00:00 2001
From: David Moreau-Simard <dms@redhat.com>
Date: Fri, 8 Apr 2016 16:32:46 -0400
Subject: [PATCH] Fix gate: Tempest setup and repositories
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- We no longer need to setup Tempest in a virtual environment
  since that is now handled by tox
- Do not explicitely require python-openstackclient since that
  is now handled by puppet-tempest since
  https://review.openstack.org/301162
- Setup packstack to consume Mitaka repositories and OPM until
  Newton is actively tested
- Make swap configuration consistent
- Add an empty other-requirements.txt file to prevent the
  openstack gate environment to pre-install dependencies for
  us; these are installed within run_tests.sh
- Enforce locale, seems necessary since the switch to the new
  centos7 images in the openstack-infra gate

Co-Authored-By: David Moreau Simard <dms@redhat.com>
Co-Authored-By: Javier Pe√±a <jpena@redhat.com>
Change-Id: I80813ee9404a3cbc837d0d9810855fb13c0d904b
(cherry picked from commit 5b2648aec3c44c6249d12305a0e99502088c5b4e)
---
 other-requirements.txt                          |  0
 packstack/puppet/templates/provision_tempest.pp |  7 --
 setup.py                                        |  2 +-

diff --git a/packstack/puppet/templates/provision_tempest.pp b/packstack/puppet/templates/provision_tempest.pp
index e5863dc..65cb9da 100644
--- a/packstack/puppet/templates/provision_tempest.pp
+++ b/packstack/puppet/templates/provision_tempest.pp
@@ -51,7 +51,6 @@ $tempest_repo_uri      = hiera('CONFIG_PROVISION_TEMPEST_REPO_URI')
 $tempest_repo_revision = hiera('CONFIG_PROVISION_TEMPEST_REPO_REVISION')
 $tempest_clone_path    = '/var/lib/tempest'
 $tempest_clone_owner   = 'root'
-$setup_venv            = true
 $tempest_user          = hiera('CONFIG_PROVISION_TEMPEST_USER')
 $tempest_password      = hiera('CONFIG_PROVISION_TEMPEST_USER_PW')
 
@@ -69,11 +68,6 @@ $heat_available       = str2bool(hiera('CONFIG_HEAT_INSTALL'))
 $swift_available      = str2bool(hiera('CONFIG_SWIFT_INSTALL'))
 $configure_tempest    = str2bool(hiera('CONFIG_PROVISION_TEMPEST'))
 
-# on standalone install we depend on this package
-package {'python-openstackclient':
-  before => Class['::tempest'],
-}
-
 class { '::tempest':
   admin_domain_name         => $admin_domain_name,
   admin_password            => $admin_password,
@@ -105,7 +99,6 @@ class { '::tempest':
   public_router_id          => $public_router_id,
   resize_available          => $resize_available,
   sahara_available          => $sahara_available,
-  setup_venv                => $setup_venv,
   swift_available           => $swift_available,
   tempest_clone_owner       => $tempest_clone_owner,
   tempest_clone_path        => $tempest_clone_path,
diff --git a/setup.py b/setup.py
index 6d209d1..d8c39c1 100644
--- a/setup.py
+++ b/setup.py
@@ -28,7 +28,7 @@ MODULES_DIR = os.environ.get('PACKSTACK_PUPPETDIR',
                              '/usr/share/openstack-puppet/modules')
 MODULES_REPO = ('https://github.com/redhat-openstack/'
                 'openstack-puppet-modules.git')
-MODULES_BRANCH = 'master'
+MODULES_BRANCH = 'stable/mitaka'
 
 
 class InstallModulesCommand(Command):
